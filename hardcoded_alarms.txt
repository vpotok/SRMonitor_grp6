
ğŸ“„ Datei: SRMAgent\Program.cs
  ğŸ”¹ URLs: https://aka.ms/aspnetcore/swashbuckle
    Zeile 13: // Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle

ğŸ“„ Datei: SRMAgent\WorkerService.cs
  ğŸ”¹ Ports: 10, 1000
    Zeile 5: private const int generalDelay = 1 * 10 * 1000; // 10 seconds

ğŸ“„ Datei: SRMAgent\Controllers\AgentDataController.cs
  ğŸ”¹ Ports: 90
    Zeile 14: CurrentBattery = 90,
  ğŸ”¹ Ports: 24
    Zeile 15: CurrentTemp = 24,
  ğŸ”¹ Ports: 10, 30
    Zeile 27: demoData.CurrentTemp = new Random().Next(10, 30);

ğŸ“„ Datei: SRMAgent\obj\Debug\net8.0\SRMAgent.AssemblyInfo.cs
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 15: [assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 19: [assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]
  ğŸ”¹ Ports: 436
    Zeile 16: [assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+436e9fb9c86348d63335d9731818f51d9ab16dec")]

ğŸ“„ Datei: SRMAuth\AuthData.cs
  ğŸ”¹ Passwords: Token
    Zeile 4: public string Token { get; set; } = "";
  ğŸ”¹ Token Keywords: Token
    Zeile 4: public string Token { get; set; } = "";

ğŸ“„ Datei: SRMAuth\Program.cs
  ğŸ”¹ Ports: 10
    Zeile 33: ClockSkew = TimeSpan.FromSeconds(10),
  ğŸ”¹ Passwords: token
    Zeile 85: var token = tokenHandler.CreateToken(tokenDescriptor);
  ğŸ”¹ Passwords: token
    Zeile 88: return Results.Ok(new { token = jwt });
  ğŸ”¹ Passwords: Password
    Zeile 95: return Results.BadRequest("Username, Password und Role mÃ¼ssen angegeben werden.");
  ğŸ”¹ Passwords: Token
    Zeile 114: // Token erstellen + in Redis speichern
  ğŸ”¹ Passwords: token
    Zeile 131: var token = tokenHandler.CreateToken(tokenDescriptor);
  ğŸ”¹ Passwords: token
    Zeile 135: await db.StringSetAsync($"token:{jwt}", "valid", TimeSpan.FromHours(1));
  ğŸ”¹ Passwords: Token, token
    Zeile 136: Console.WriteLine($"ğŸ” Token gespeichert in Redis: token:{jwt}");
  ğŸ”¹ Passwords: token
    Zeile 138: return Results.Ok(new { token = jwt });
  ğŸ”¹ Passwords: Token
    Zeile 141: // Token validieren + Redis check
  ğŸ”¹ Passwords: token
    Zeile 151: var token = authHeader.Replace("Bearer ", "");
  ğŸ”¹ Passwords: token
    Zeile 153: var exists = await db.KeyExistsAsync($"token:{token}");
  ğŸ”¹ Passwords: Token
    Zeile 155: Console.WriteLine(exists ? "âœ… Token in Redis gefunden." : "âŒ Token nicht in Redis vorhanden.");
  ğŸ”¹ Passwords: Token
    Zeile 175: // ğŸ”“ Token lÃ¶schen (Logout) â€“ abgesichert mit [Authorize]
  ğŸ”¹ Passwords: token
    Zeile 185: var token = authHeader.Replace("Bearer ", "");
  ğŸ”¹ Passwords: token
    Zeile 187: var deleted = await db.KeyDeleteAsync($"token:{token}");
  ğŸ”¹ Passwords: Token, token
    Zeile 190: ? $"ğŸ§¹ Token gelÃ¶scht: token:{token}"
  ğŸ”¹ Passwords: Token, token
    Zeile 191: : $"âš ï¸ Token war nicht vorhanden: token:{token}");
  ğŸ”¹ JWT Keywords: Jwt
    Zeile 6: using System.IdentityModel.Tokens.Jwt;
  ğŸ”¹ JWT Keywords: JWT, Jwt
    Zeile 14: var jwtKey = configuration["Jwt:Key"] ?? throw new Exception("JWT-Key fehlt in der Konfiguration.");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 86: var jwt = tokenHandler.WriteToken(token);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 88: return Results.Ok(new { token = jwt });
  ğŸ”¹ JWT Keywords: jwt
    Zeile 132: var jwt = tokenHandler.WriteToken(token);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 135: await db.StringSetAsync($"token:{jwt}", "valid", TimeSpan.FromHours(1));
  ğŸ”¹ JWT Keywords: jwt
    Zeile 136: Console.WriteLine($"ğŸ” Token gespeichert in Redis: token:{jwt}");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 138: return Results.Ok(new { token = jwt });
  ğŸ”¹ Token Keywords: token
    Zeile 85: var token = tokenHandler.CreateToken(tokenDescriptor);
  ğŸ”¹ Token Keywords: token
    Zeile 86: var jwt = tokenHandler.WriteToken(token);
  ğŸ”¹ Token Keywords: token
    Zeile 88: return Results.Ok(new { token = jwt });
  ğŸ”¹ Token Keywords: Authorization
    Zeile 92: app.MapPost("/auth/register", [Microsoft.AspNetCore.Authorization.Authorize(Roles = "SuperAdmin")] async (HttpContext http, IConnectionMultiplexer redis, RegisterRequest request) =>
  ğŸ”¹ Token Keywords: Token
    Zeile 114: // Token erstellen + in Redis speichern
  ğŸ”¹ Token Keywords: token
    Zeile 115: app.MapPost("/api/token", async (TokenRequest request, IConnectionMultiplexer redis) =>
  ğŸ”¹ Token Keywords: token
    Zeile 131: var token = tokenHandler.CreateToken(tokenDescriptor);
  ğŸ”¹ Token Keywords: token
    Zeile 132: var jwt = tokenHandler.WriteToken(token);
  ğŸ”¹ Token Keywords: token
    Zeile 135: await db.StringSetAsync($"token:{jwt}", "valid", TimeSpan.FromHours(1));
  ğŸ”¹ Token Keywords: Token, token
    Zeile 136: Console.WriteLine($"ğŸ” Token gespeichert in Redis: token:{jwt}");
  ğŸ”¹ Token Keywords: token
    Zeile 138: return Results.Ok(new { token = jwt });
  ğŸ”¹ Token Keywords: Token
    Zeile 141: // Token validieren + Redis check
  ğŸ”¹ Token Keywords: Authorization
    Zeile 142: app.MapPost("/api/validate", [Microsoft.AspNetCore.Authorization.Authorize] async (HttpContext http, IConnectionMultiplexer redis, ClaimsPrincipal user) =>
  ğŸ”¹ Token Keywords: Authorization
    Zeile 144: var authHeader = http.Request.Headers["Authorization"].ToString();
  ğŸ”¹ Token Keywords: Bearer
    Zeile 145: if (string.IsNullOrEmpty(authHeader) || !authHeader.StartsWith("Bearer "))
  ğŸ”¹ Token Keywords: Authorization
    Zeile 147: Console.WriteLine("âŒ Kein Authorization-Header oder falsches Format.");
  ğŸ”¹ Token Keywords: Bearer, token
    Zeile 151: var token = authHeader.Replace("Bearer ", "");
  ğŸ”¹ Token Keywords: token
    Zeile 153: var exists = await db.KeyExistsAsync($"token:{token}");
  ğŸ”¹ Token Keywords: Token
    Zeile 155: Console.WriteLine(exists ? "âœ… Token in Redis gefunden." : "âŒ Token nicht in Redis vorhanden.");
  ğŸ”¹ Token Keywords: Token
    Zeile 175: // ğŸ”“ Token lÃ¶schen (Logout) â€“ abgesichert mit [Authorize]
  ğŸ”¹ Token Keywords: Authorization
    Zeile 176: app.MapPost("/api/logout", [Microsoft.AspNetCore.Authorization.Authorize] async (
  ğŸ”¹ Token Keywords: Authorization
    Zeile 181: var authHeader = http.Request.Headers["Authorization"].ToString();
  ğŸ”¹ Token Keywords: Bearer
    Zeile 182: if (string.IsNullOrEmpty(authHeader) || !authHeader.StartsWith("Bearer "))
  ğŸ”¹ Token Keywords: Authorization
    Zeile 183: return Results.BadRequest("Kein oder ungÃ¼ltiger Authorization-Header.");
  ğŸ”¹ Token Keywords: Bearer, token
    Zeile 185: var token = authHeader.Replace("Bearer ", "");
  ğŸ”¹ Token Keywords: token
    Zeile 187: var deleted = await db.KeyDeleteAsync($"token:{token}");
  ğŸ”¹ Token Keywords: Token, token
    Zeile 190: ? $"ğŸ§¹ Token gelÃ¶scht: token:{token}"
  ğŸ”¹ Token Keywords: Token, token
    Zeile 191: : $"âš ï¸ Token war nicht vorhanden: token:{token}");
  ğŸ”¹ Token Keywords: Token
    Zeile 193: // Optional: logge auch den Benutzername oder Role aus dem Token
  ğŸ”¹ Connection Stringss: ConnectionString
    Zeile 15: var redisConnection = configuration.GetSection("Redis")["ConnectionString"] ?? "redis:6379";

ğŸ“„ Datei: SRMAuth\Controllers\AuthController.cs
  ğŸ”¹ JWT Keywords: Jwt
    Zeile 1: using System.IdentityModel.Tokens.Jwt;

ğŸ“„ Datei: SRMAuth\Models\LoginRequest.cs
  ğŸ”¹ Passwords: Password
    Zeile 6: public string Password { get; set; } = string.Empty;

ğŸ“„ Datei: SRMAuth\Models\RegisterRequest.cs
  ğŸ”¹ Passwords: Password
    Zeile 6: public string Password { get; set; } = string.Empty;

ğŸ“„ Datei: SRMAuth\obj\Debug\net8.0\SRMAuth.AssemblyInfo.cs
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 15: [assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 19: [assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]
  ğŸ”¹ Ports: 436
    Zeile 16: [assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+436e9fb9c86348d63335d9731818f51d9ab16dec")]

ğŸ“„ Datei: SRMAuth\Services\TokenService.cs
  ğŸ”¹ Passwords: token
    Zeile 29: var token = new JwtSecurityToken(
  ğŸ”¹ JWT Keywords: Jwt
    Zeile 1: using System.IdentityModel.Tokens.Jwt;
  ğŸ”¹ JWT Keywords: Jwt
    Zeile 26: var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config["Jwt:Key"]!));
  ğŸ”¹ Token Keywords: token
    Zeile 29: var token = new JwtSecurityToken(
  ğŸ”¹ Token Keywords: token
    Zeile 34: return new JwtSecurityTokenHandler().WriteToken(token);

ğŸ“„ Datei: SRMCore\Program.cs
  ğŸ”¹ URLs: http://localhost:5173
    Zeile 61: policy.WithOrigins("http://localhost:5173")
  ğŸ”¹ Ports: 2714
    Zeile 104: catch (SqlException ex) when (ex.Number == 2714) // "There is already an object named ..."
  ğŸ”¹ Ports: 64
    Zeile 195: AuthToken = GenerateSecureToken(64),
  ğŸ”¹ Ports: 64
    Zeile 202: AuthToken = GenerateSecureToken(64),
  ğŸ”¹ Passwords: Token
    Zeile 217: Console.WriteLine("ğŸ§¾ Agent Token Ãœbersicht:");
  ğŸ”¹ API Keys: API-Key
    Zeile 166: // ğŸ”„ Redmine-API-Key automatisch setzen/Ã¼berschreiben
  ğŸ”¹ API Keys: API-Key
    Zeile 170: throw new Exception("Redmine API-Key fehlt in der Konfiguration (Redmine:ApiKey)");
  ğŸ”¹ API Keys: ApiKey
    Zeile 183: ApiKey = currentApiKey
  ğŸ”¹ JWT Keywords: JWT
    Zeile 14: // ğŸ”‘ JWT-Konfiguration
  ğŸ”¹ JWT Keywords: JWT, Jwt
    Zeile 15: var jwtKey = builder.Configuration["Jwt:Key"] ?? throw new Exception("JWT-Key fehlt in der Konfiguration.");
  ğŸ”¹ JWT Keywords: JWT
    Zeile 24: // ğŸ” Authentifizierung & JWT-Validierung
  ğŸ”¹ Token Keywords: Token
    Zeile 211: // Token-Ausgabe fÃ¼r Debugzwecke
  ğŸ”¹ Token Keywords: Token
    Zeile 217: Console.WriteLine("ğŸ§¾ Agent Token Ãœbersicht:");
  ğŸ”¹ Token Keywords: Token
    Zeile 227: // ğŸ” Hilfsfunktion zur Token-Generierung
  ğŸ”¹ Common Hostss: localhost
    Zeile 61: policy.WithOrigins("http://localhost:5173")

ğŸ“„ Datei: SRMCore\Controllers\AuthController.cs
  ğŸ”¹ Ports: 500
    Zeile 88: return StatusCode(500, "Fehler bei der Tokenvalidierung.");
  ğŸ”¹ Ports: 500
    Zeile 124: return StatusCode(500, "Fehler beim Abmelden.");
  ğŸ”¹ Passwords: token
    Zeile 32: var token = await _tokenService.RequestTokenAsync(user.UserId, user.Role, user.ComId);
  ğŸ”¹ Passwords: Token
    Zeile 48: // 1. Token extrahieren
  ğŸ”¹ Passwords: token
    Zeile 49: var token = Request.Headers["Authorization"].ToString().Replace("Bearer ", "");
  ğŸ”¹ Passwords: token
    Zeile 52: token = Request.Cookies["jwt"];
  ğŸ”¹ Passwords: Token
    Zeile 56: return Unauthorized("Kein Token vorhanden.");
  ğŸ”¹ Passwords: Token
    Zeile 74: return Unauthorized("Token ungÃ¼ltig.");
  ğŸ”¹ Passwords: token
    Zeile 98: var token = Request.Headers["Authorization"].ToString().Replace("Bearer ", "");
  ğŸ”¹ Passwords: token
    Zeile 101: token = Request.Cookies["jwt"];
  ğŸ”¹ Passwords: Token
    Zeile 105: return Unauthorized("Kein Token vorhanden.");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 34: Response.Cookies.Append("jwt", token, new CookieOptions
  ğŸ”¹ JWT Keywords: jwt
    Zeile 52: token = Request.Cookies["jwt"];
  ğŸ”¹ JWT Keywords: jwt
    Zeile 101: token = Request.Cookies["jwt"];
  ğŸ”¹ JWT Keywords: jwt
    Zeile 117: Response.Cookies.Delete("jwt");
  ğŸ”¹ Token Keywords: Authorization
    Zeile 1: using Microsoft.AspNetCore.Authorization;
  ğŸ”¹ Token Keywords: TOKEN
    Zeile 30: Console.WriteLine($"ğŸ§ª TOKEN-REQUEST: uid={user.UserId}, role={user.Role}, comId={user.ComId}");
  ğŸ”¹ Token Keywords: token
    Zeile 32: var token = await _tokenService.RequestTokenAsync(user.UserId, user.Role, user.ComId);
  ğŸ”¹ Token Keywords: token
    Zeile 34: Response.Cookies.Append("jwt", token, new CookieOptions
  ğŸ”¹ Token Keywords: Token
    Zeile 48: // 1. Token extrahieren
  ğŸ”¹ Token Keywords: Authorization, Bearer, token
    Zeile 49: var token = Request.Headers["Authorization"].ToString().Replace("Bearer ", "");
  ğŸ”¹ Token Keywords: token
    Zeile 50: if (string.IsNullOrEmpty(token))
  ğŸ”¹ Token Keywords: token
    Zeile 52: token = Request.Cookies["jwt"];
  ğŸ”¹ Token Keywords: token
    Zeile 55: if (string.IsNullOrEmpty(token))
  ğŸ”¹ Token Keywords: Token
    Zeile 56: return Unauthorized("Kein Token vorhanden.");
  ğŸ”¹ Token Keywords: Token
    Zeile 58: // 2. Anfrage an Token-Service vorbereiten
  ğŸ”¹ Token Keywords: Authorization, Bearer, token
    Zeile 61: httpRequest.Headers.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
  ğŸ”¹ Token Keywords: TOKEN
    Zeile 68: Console.WriteLine($"ğŸ“¥ TOKEN-VALIDIERUNG: StatusCode = {response.StatusCode}");
  ğŸ”¹ Token Keywords: TOKEN
    Zeile 70: Console.WriteLine($"ğŸ“¦ TOKEN-RESPONSE: {rawResponse}");
  ğŸ”¹ Token Keywords: Token
    Zeile 74: return Unauthorized("Token ungÃ¼ltig.");
  ğŸ”¹ Token Keywords: Token
    Zeile 87: Console.WriteLine($"âŒ Fehler beim Token-Service: {ex.Message}");
  ğŸ”¹ Token Keywords: Authorization, Bearer, token
    Zeile 98: var token = Request.Headers["Authorization"].ToString().Replace("Bearer ", "");
  ğŸ”¹ Token Keywords: token
    Zeile 99: if (string.IsNullOrEmpty(token))
  ğŸ”¹ Token Keywords: token
    Zeile 101: token = Request.Cookies["jwt"];
  ğŸ”¹ Token Keywords: token
    Zeile 104: if (string.IsNullOrEmpty(token))
  ğŸ”¹ Token Keywords: Token
    Zeile 105: return Unauthorized("Kein Token vorhanden.");
  ğŸ”¹ Token Keywords: Authorization, Bearer, token
    Zeile 111: httpRequest.Headers.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);

ğŸ“„ Datei: SRMCore\Controllers\CoreServiceController.cs
  ğŸ”¹ Ports: 100
    Zeile 71: query = (IOrderedQueryable<Log>)query.Take(100);
  ğŸ”¹ Passwords: token
    Zeile 34: var token = Request.Headers["X-AGENT-TOKEN"].ToString();
  ğŸ”¹ Passwords: token
    Zeile 63: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Passwords: token
    Zeile 64: if (token == null || !token.Valid) return Unauthorized();
  ğŸ”¹ Passwords: token
    Zeile 83: var token = Request.Headers["X-AGENT-TOKEN"].ToString();
  ğŸ”¹ JWT Keywords: jwt
    Zeile 62: var jwt = authHeader.Replace("Bearer ", "");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 63: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: TOKEN, token
    Zeile 34: var token = Request.Headers["X-AGENT-TOKEN"].ToString();
  ğŸ”¹ Token Keywords: token
    Zeile 35: if (string.IsNullOrWhiteSpace(token)) return Unauthorized();
  ğŸ”¹ Token Keywords: token
    Zeile 37: var comId = await _agentAuth.ValidateAgentAsync(token);
  ğŸ”¹ Token Keywords: Authorization
    Zeile 59: var authHeader = Request.Headers.Authorization.ToString();
  ğŸ”¹ Token Keywords: Bearer
    Zeile 60: if (!authHeader.StartsWith("Bearer ")) return Unauthorized();
  ğŸ”¹ Token Keywords: Bearer
    Zeile 62: var jwt = authHeader.Replace("Bearer ", "");
  ğŸ”¹ Token Keywords: token
    Zeile 63: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: token
    Zeile 64: if (token == null || !token.Valid) return Unauthorized();
  ğŸ”¹ Token Keywords: token
    Zeile 67: .Where(l => l.ComId == token.CustomerId)
  ğŸ”¹ Token Keywords: token
    Zeile 70: if (token.Role?.ToLower() == "customer")
  ğŸ”¹ Token Keywords: TOKEN, token
    Zeile 83: var token = Request.Headers["X-AGENT-TOKEN"].ToString();
  ğŸ”¹ Token Keywords: token
    Zeile 84: if (string.IsNullOrWhiteSpace(token)) return Unauthorized();
  ğŸ”¹ Token Keywords: token
    Zeile 86: var comId = await _agentAuth.ValidateAgentAsync(token);

ğŸ“„ Datei: SRMCore\Controllers\IPController.cs
  ğŸ”¹ Passwords: token
    Zeile 56: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Passwords: token
    Zeile 57: if (token == null || !token.Valid)
  ğŸ”¹ Passwords: Token
    Zeile 63: _logger.LogInformation("âœ… GÃ¼ltiger Token fÃ¼r ComId={ComId}, Role={Role}", token.CustomerId, token.Role);
  ğŸ”¹ Passwords: token
    Zeile 86: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Passwords: token
    Zeile 87: if (token == null || !token.Valid)
  ğŸ”¹ Passwords: token
    Zeile 124: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Passwords: token
    Zeile 125: if (token == null || !token.Valid)
  ğŸ”¹ Passwords: token
    Zeile 156: var token = Request.Headers["X-AGENT-TOKEN"].FirstOrDefault();
  ğŸ”¹ Passwords: Token
    Zeile 159: _logger.LogWarning("ğŸ”’ Kein Agent-Token Ã¼bergeben.");
  ğŸ”¹ Passwords: Token
    Zeile 166: _logger.LogWarning("ğŸ”‘ UngÃ¼ltiges Agent-Token: {Token}", token);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 33: var cookieToken = Request.Cookies["jwt"];
  ğŸ”¹ JWT Keywords: JWT
    Zeile 36: _logger.LogDebug("JWT extrahiert aus Cookie: {Token}", cookieToken);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 49: var jwt = ExtractBearerToken();
  ğŸ”¹ JWT Keywords: jwt
    Zeile 50: if (jwt == null)
  ğŸ”¹ JWT Keywords: JWT
    Zeile 52: _logger.LogWarning("ğŸ”’ Zugriff ohne JWT");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 56: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 79: var jwt = ExtractBearerToken();
  ğŸ”¹ JWT Keywords: jwt
    Zeile 80: if (jwt == null)
  ğŸ”¹ JWT Keywords: JWT
    Zeile 82: _logger.LogWarning("ğŸ”’ Zugriff ohne JWT");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 86: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ JWT Keywords: jwt
    Zeile 117: var jwt = ExtractBearerToken();
  ğŸ”¹ JWT Keywords: jwt
    Zeile 118: if (jwt == null)
  ğŸ”¹ JWT Keywords: JWT
    Zeile 120: _logger.LogWarning("ğŸ”’ Zugriff ohne JWT");
  ğŸ”¹ JWT Keywords: jwt
    Zeile 124: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: Authorization
    Zeile 1: using Microsoft.AspNetCore.Authorization;
  ğŸ”¹ Token Keywords: Authorization
    Zeile 30: var authHeader = Request.Headers.Authorization.FirstOrDefault();
  ğŸ”¹ Token Keywords: Authorization
    Zeile 31: _logger.LogDebug("Authorization Header: {Header}", authHeader);
  ğŸ”¹ Token Keywords: Token
    Zeile 36: _logger.LogDebug("JWT extrahiert aus Cookie: {Token}", cookieToken);
  ğŸ”¹ Token Keywords: Authorization
    Zeile 40: _logger.LogWarning("Kein gÃ¼ltiger Authorization Header oder Cookie vorhanden.");
  ğŸ”¹ Token Keywords: token
    Zeile 56: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: token
    Zeile 57: if (token == null || !token.Valid)
  ğŸ”¹ Token Keywords: Token
    Zeile 59: _logger.LogWarning("ğŸ”‘ UngÃ¼ltiger oder abgelaufener Token.");
  ğŸ”¹ Token Keywords: Token, token
    Zeile 63: _logger.LogInformation("âœ… GÃ¼ltiger Token fÃ¼r ComId={ComId}, Role={Role}", token.CustomerId, token.Role);
  ğŸ”¹ Token Keywords: token
    Zeile 66: .Where(i => i.ComId == token.CustomerId)
  ğŸ”¹ Token Keywords: token
    Zeile 70: _logger.LogInformation("ğŸ“¤ {Count} IPs gefunden fÃ¼r ComId={ComId}", ips.Count, token.CustomerId);
  ğŸ”¹ Token Keywords: token
    Zeile 86: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: token
    Zeile 87: if (token == null || !token.Valid)
  ğŸ”¹ Token Keywords: Token
    Zeile 89: _logger.LogWarning("ğŸ”‘ UngÃ¼ltiger oder abgelaufener Token.");
  ğŸ”¹ Token Keywords: token
    Zeile 93: if (token.Role != "customeradmin")
  ğŸ”¹ Token Keywords: token
    Zeile 95: _logger.LogWarning("ğŸš« Zugriff verweigert â€“ Rolle ist nicht 'customeradmin'. Aktuelle Rolle: {Role}", token.Role);
  ğŸ”¹ Token Keywords: token
    Zeile 99: if (await _db.IPs.AnyAsync(i => i.ComId == token.CustomerId && i.IpAddress == ip))
  ğŸ”¹ Token Keywords: token
    Zeile 101: _logger.LogWarning("âš ï¸ IP {Ip} existiert bereits fÃ¼r ComId={ComId}", ip, token.CustomerId);
  ğŸ”¹ Token Keywords: token
    Zeile 105: _db.IPs.Add(new IP { ComId = token.CustomerId, IpAddress = ip });
  ğŸ”¹ Token Keywords: token
    Zeile 108: _logger.LogInformation("âœ… IP {Ip} hinzugefÃ¼gt fÃ¼r ComId={ComId}", ip, token.CustomerId);
  ğŸ”¹ Token Keywords: token
    Zeile 124: var token = await _tokenValidator.ValidateTokenAsync(jwt);
  ğŸ”¹ Token Keywords: token
    Zeile 125: if (token == null || !token.Valid)
  ğŸ”¹ Token Keywords: Token
    Zeile 127: _logger.LogWarning("ğŸ”‘ UngÃ¼ltiger oder abgelaufener Token.");
  ğŸ”¹ Token Keywords: token
    Zeile 131: if (token.Role != "customeradmin")
  ğŸ”¹ Token Keywords: token
    Zeile 133: _logger.LogWarning("ğŸš« Zugriff verweigert â€“ Rolle ist nicht 'customeradmin'. Aktuelle Rolle: {Role}", token.Role);
  ğŸ”¹ Token Keywords: token
    Zeile 137: var entry = await _db.IPs.FirstOrDefaultAsync(i => i.ComId == token.CustomerId && i.IpAddress == ip);
  ğŸ”¹ Token Keywords: token
    Zeile 140: _logger.LogWarning("âŒ IP {Ip} nicht gefunden fÃ¼r ComId={ComId}", ip, token.CustomerId);
  ğŸ”¹ Token Keywords: token
    Zeile 147: _logger.LogInformation("ğŸ—‘ï¸ IP {Ip} gelÃ¶scht fÃ¼r ComId={ComId}", ip, token.CustomerId);
  ğŸ”¹ Token Keywords: TOKEN, token
    Zeile 156: var token = Request.Headers["X-AGENT-TOKEN"].FirstOrDefault();
  ğŸ”¹ Token Keywords: token
    Zeile 157: if (string.IsNullOrWhiteSpace(token))
  ğŸ”¹ Token Keywords: Token
    Zeile 159: _logger.LogWarning("ğŸ”’ Kein Agent-Token Ã¼bergeben.");
  ğŸ”¹ Token Keywords: token
    Zeile 163: var comId = await _agentAuth.ValidateAgentAsync(token);
  ğŸ”¹ Token Keywords: Token, token
    Zeile 166: _logger.LogWarning("ğŸ”‘ UngÃ¼ltiges Agent-Token: {Token}", token);

ğŸ“„ Datei: SRMCore\Data\CoreDbContext.cs
  ğŸ”¹ API Keys: ApiKey
    Zeile 25: modelBuilder.Entity<Redmine>().HasKey(r => new { r.ComId, r.ApiKey });
  ğŸ”¹ API Keys: ApiKey
    Zeile 63: .HasIndex(r => new { r.ComId, r.ApiKey })

ğŸ“„ Datei: SRMCore\Migrations\20250514220451_InitialCreate.cs
  ğŸ”¹ Ports: 450
    Zeile 32: AuthToken = table.Column<string>(type: "nvarchar(450)", nullable: false),
  ğŸ”¹ Ports: 450
    Zeile 51: IpAddress = table.Column<string>(type: "nvarchar(450)", nullable: false),
  ğŸ”¹ Ports: 450
    Zeile 92: ApiKey = table.Column<string>(type: "nvarchar(450)", nullable: false)
  ğŸ”¹ API Keys: ApiKey
    Zeile 92: ApiKey = table.Column<string>(type: "nvarchar(450)", nullable: false)
  ğŸ”¹ API Keys: ApiKey
    Zeile 96: table.PrimaryKey("PK_Redmines", x => new { x.ComId, x.ApiKey });

ğŸ“„ Datei: SRMCore\Migrations\20250514220451_InitialCreate.Designer.cs
  ğŸ”¹ Ports: 612, 618
    Zeile 21: #pragma warning disable 612, 618
  ğŸ”¹ Ports: 128
    Zeile 24: .HasAnnotation("Relational:MaxIdentifierLength", 128);
  ğŸ”¹ Ports: 450
    Zeile 36: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 450
    Zeile 77: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 450
    Zeile 122: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 612, 618
    Zeile 232: #pragma warning restore 612, 618

ğŸ“„ Datei: SRMCore\Migrations\CoreDbContextModelSnapshot.cs
  ğŸ”¹ Ports: 612, 618
    Zeile 18: #pragma warning disable 612, 618
  ğŸ”¹ Ports: 128
    Zeile 21: .HasAnnotation("Relational:MaxIdentifierLength", 128);
  ğŸ”¹ Ports: 450
    Zeile 33: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 450
    Zeile 74: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 450
    Zeile 119: .HasColumnType("nvarchar(450)");
  ğŸ”¹ Ports: 612, 618
    Zeile 229: #pragma warning restore 612, 618

ğŸ“„ Datei: SRMCore\Models\LoginRequest.cs
  ğŸ”¹ Passwords: Password
    Zeile 6: public string Password { get; set; } = null!;

ğŸ“„ Datei: SRMCore\Models\Redmine.cs
  ğŸ”¹ API Keys: ApiKey
    Zeile 6: public string ApiKey { get; set; } = null!;

ğŸ“„ Datei: SRMCore\obj\Debug\net8.0\SRMCore.AssemblyInfo.cs
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 15: [assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
  ğŸ”¹ IP Addresss: 1.0.0.0
    Zeile 19: [assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]
  ğŸ”¹ Ports: 436
    Zeile 16: [assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+436e9fb9c86348d63335d9731818f51d9ab16dec")]

ğŸ“„ Datei: SRMCore\Services\AgentAuthService.cs
  ğŸ”¹ Passwords: token
    Zeile 17: var agent = await _db.Agents.FirstOrDefaultAsync(a => a.AuthToken == token && a.Enabled);
  ğŸ”¹ Token Keywords: token
    Zeile 15: public async Task<int?> ValidateAgentAsync(string token)
  ğŸ”¹ Token Keywords: token
    Zeile 17: var agent = await _db.Agents.FirstOrDefaultAsync(a => a.AuthToken == token && a.Enabled);

ğŸ“„ Datei: SRMCore\Services\AlarmService.cs
  ğŸ”¹ Ports: 30
    Zeile 24: if (data.CurrentTemp > 30)
  ğŸ”¹ Ports: 30
    Zeile 25: messages.Add($"Temperatur Ã¼ber 30Â°C: {data.CurrentTemp}Â°C");

ğŸ“„ Datei: SRMCore\Services\IAgentAuthService.cs
  ğŸ”¹ Token Keywords: token
    Zeile 5: Task<int?> ValidateAgentAsync(string token);

ğŸ“„ Datei: SRMCore\Services\ITokenValidationService.cs
  ğŸ”¹ Token Keywords: token
    Zeile 7: Task<TokenValidationResult?> ValidateTokenAsync(string token);

ğŸ“„ Datei: SRMCore\Services\RedmineService.cs
  ğŸ”¹ URLs: http://redmine:3000/issues.json
    Zeile 36: var req = new HttpRequestMessage(HttpMethod.Post, "http://redmine:3000/issues.json");
  ğŸ”¹ API Keys: API-Key
    Zeile 34: _logger.LogInformation("ğŸ”‘ Redmine API-Key fÃ¼r ComId={ComId}: {ApiKey}", comId, redmine.ApiKey); // ğŸ‘ˆ NEU

ğŸ“„ Datei: SRMCore\Services\TokenService.cs
  ğŸ”¹ Passwords: Token
    Zeile 35: Console.WriteLine($"âŒ Token request failed: {response.StatusCode} â€“ {error}");
  ğŸ”¹ Token Keywords: token
    Zeile 30: $"{_config["TokenService:BaseUrl"]}/api/token", request);
  ğŸ”¹ Token Keywords: Token
    Zeile 35: Console.WriteLine($"âŒ Token request failed: {response.StatusCode} â€“ {error}");
  ğŸ”¹ Token Keywords: token
    Zeile 40: return result?["token"] ?? string.Empty;

ğŸ“„ Datei: SRMCore\Services\TokenValidationService.cs
  ğŸ”¹ Token Keywords: token
    Zeile 19: public async Task<TokenValidationResult?> ValidateTokenAsync(string token)
  ğŸ”¹ Token Keywords: Authorization, Bearer, token
    Zeile 22: request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);